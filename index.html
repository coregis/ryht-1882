<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Raise Your Hand Texas SB 1882 Web Map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css' rel='stylesheet' />
		<link href="css/ryht-1882-style.css" rel="stylesheet" />
		<style>
			body { margin:0; padding:0; }
			#map { position:absolute; top:0; bottom:0; width:100%; }
			.mapboxgl-popup {
				max-width: 400px;
				font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;
			}
		</style>
</head>
<body>

<div id='map'></div>

<div class='legend'>
	<div class='legend-title'>Potential Funding Increases by District Under SB 1822</div>
		<div class='legend-subtitle'>Dollars per Average Daily Attendance (ADA)</div>
			<div class='legend-scale'>
				  <ul class='legend-labels'>
					<li><span style='background:#eeffe6;'></span>No increase</li>
					<li><span style='background:#b8e65c;'></span>$1 - 1,000</li>
					<li><span style='background:#7ba822;'></span>$1,001 - $2,000</li>
					<li><span style='background:#3c5900;'></span>More than $2,000</li>
				  </ul>
			</div>			
		<div class='legend-source'>Source: <a href="http://ballardhistory.org/"  target="_blank">Mapping Historic Ballard Project</a></div>
		<div class='map-credit'>Map design by <a href="http://www.coregis.net/"  target="_blank">CORE GIS</a></div>
	</div>
</div>

<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiY29yZS1naXMiLCJhIjoiaUxqQS1zQSJ9.mDT5nb8l_dWIHzbnOTebcQ';

//set bounds to Texas
			var bounds = [
					[-114.9594,21.637], // southwest coords
					[-85.50,39.317] // northeast coords
				];

var map = new mapboxgl.Map({
    container: 'map', // container id
    style: 'mapbox://styles/core-gis/cjm2gaa5p950g2rn6pg3u90ko', // stylesheet location; this is the migrated style with markers turned OFF and 1882 polys on
    center: [-98.560161, 31.314160], // starting position [lng, lat]
	zoom: 5.4, // starting zoom
	maxBounds: bounds // sets bounds as max
	
});

map.on('load', function () {

	map.addSource('districts_1882',{
		type:'vector',
		url:'mapbox://core-gis.b73007d3'
		});
		//Add a map layer for all the parcels

	map.addLayer({
		"id":"districts_1882_lines",
		"type":"fill",
		"source":"districts_1882",
		"source-layer":"texas_districts_1882_v1",
		"layout":{		},
		"paint":{
			'fill-color': 'rgba(200, 100, 240, 0)',
            'fill-outline-color': 'rgba(200, 100, 240, 0)'
			}	
	});
});

// When a click event occurs on a feature in the states layer, open a popup at the
    // location of the click, with description HTML from its properties.
    map.on('click', 'districts_1882_lines', function (e) {
        new mapboxgl.Popup()
            .setLngLat(e.lngLat)
            .setHTML(fillpopup(e.features[0].properties))
            .addTo(map);
		console.log(e.features[0].properties);
    });
	
	 // Change the cursor to a pointer when the mouse is over the parcel layer.
    map.on('mouseenter', 'districts_1882_lines', function () {
        map.getCanvas().style.cursor = 'pointer';
    });

    // Change it back to a pointer when it leaves.
    map.on('mouseleave', 'districts_1882_lines', function () {
        map.getCanvas().style.cursor = '';
    });
	
	function fillpopup(data){
		var html = "";
		html = html + "<span class='varname'>District Name: </span> <span class='attribute'>" + data.SchDistNam + "</span>";
		html = html + "<br>"
		html = html + "<span class='varname'>Total Increase: </span> <span class='attribute'>" + "$" + data.Sum_of_Gai + "</span>";
		html = html + "<br>"
		html = html + "<span class='varname'>Increase per ADA</span> <span class='attribute'>" + "$" + data.Est_ADA_In +"</span>";
		return html;
		//this will return the string to the calling function
		
	}

</script>

</body>
</html>